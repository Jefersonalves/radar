# EXAMPLE AT: https://github.com/nevercaution/docker-django-uwsgi-nginx
version: "3.4"

volumes:
    volume_radar_pg_data:
    volume_radar_django_static:
    volume_radar_sockets:

services:

    postgres:
        image: postgres:10.2-alpine
        environment:
            - POSTGRES_USER=radar
            - POSTGRES_PASSWORD=${RADAR_DB_PASSWORD}
            - POSTGRES_DB=radar
              #    volumes:
              # - "volume_radar_pg_data:/var/lib/postgresql/data/pgdata"

    nginx:
        image: nginx:1.13-alpine
        volumes:
            - volume_radar_django_static:/radar/radar_parlamentar/static
            - volume_radar_sockets:/radar/sockets/
            - ./deploy:/radar/deploy
            - ./deploy/radar.nginx.conf:/etc/nginx/conf.d/default.conf
        ports:
            - "80:80"
            - "443:443"

    # memcache:
    #    image: memcached:1.5-alpine

    # elasticsearch:
    #    image: elasticsearch:6.2.2


    django:
        image: radarparlamentar/radar
        build: .
        volumes:
            - .:/radar
            - volume_radar_sockets:/radar/sockets/
            - volume_radar_django_static:/radar/radar_parlamentar/static
        links:
            - postgres
            # - rabbitmq
        depends_on:
            - postgres
            - nginx
            # - rabbitmq

    # rabbitmq:
    #   image: 3.7-alpine
    #
    # celery:
    #     image: radarparlamentar
    #     build: .
    #     environment:
    #         - RADAR_CMD=${RADAR_CMD}
    #     volumes:
    #         - .:/radar
    #     links:
    #         - postgres
    #         - rabbitmq
    #     depends_on:
    #         - postgres
    #         # - rabbitmq
